<div class="min-h-screen bg-gradient-to-br from-blue-600 via-indigo-600 to-purple-700 p-6">
  <!-- header actions -->
  <div class="max-w-7xl mx-auto flex flex-col gap-4">
    <button
      routerLink="/"
      class="w-fit flex items-center gap-2 text-indigo-100 hover:text-white font-medium bg-white/10 hover:bg-white/20 px-4 py-2 rounded-full border border-white/30 backdrop-blur-md shadow transition-all duration-300"
    >
      <span>←</span>
      Retour à l’accueil
    </button>

    <div class="bg-white/95 backdrop-blur-xl p-6 rounded-2xl shadow-2xl border border-white/20">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <h2 class="text-2xl font-bold text-indigo-700">Carte des pollutions</h2>
          <p class="text-gray-500 text-sm">Markers basés sur latitude / longitude (OpenStreetMap).</p>
        </div>

        <div class="flex flex-col md:flex-row gap-3 md:items-center">
          <input
            class="w-full md:w-72 p-2.5 border rounded-lg focus:ring-2 focus:ring-indigo-400 outline-none"
            placeholder="Rechercher (titre, lieu, type...)"
            [(ngModel)]="search"
            (input)="onFilterChanged()"
            aria-label="Rechercher"
          />

          <select
            class="w-full md:w-60 p-2.5 border rounded-lg focus:ring-2 focus:ring-indigo-400 outline-none"
            [(ngModel)]="selectedType"
            (change)="onFilterChanged()"
            aria-label="Filtrer par type"
          >
            <option value="all">Tous les types</option>
            <option *ngFor="let t of types" [value]="t">{{ t }}</option>
          </select>

          <button
            class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-semibold shadow transition"
            (click)="loadPollutions()"
          >
            Rafraîchir
          </button>
        </div>
      </div>

      <div *ngIf="loading" class="mt-4 text-gray-600">Chargement...</div>
      <div *ngIf="errorMsg" class="mt-4 text-red-600 font-medium">{{ errorMsg }}</div>

      <div class="mt-5 grid grid-cols-1 lg:grid-cols-3 gap-5">
        <!-- map -->
        <div class="lg:col-span-2">
          <div class="rounded-2xl overflow-hidden border shadow bg-white">
            <div #mapContainer class="w-full h-[520px]"></div>
          </div>

          <div class="mt-3 flex items-center justify-between text-sm text-indigo-100">
            <span class="opacity-90">Résultats: <b>{{ filteredPollutions.length }}</b></span>
            <button
              class="bg-white/10 hover:bg-white/20 px-3 py-1.5 rounded-full border border-white/30 transition"
              (click)="fitToMarkers()"
              type="button"
            >
              Ajuster la vue
            </button>
          </div>
        </div>

        <!-- list -->
        <div class="bg-white/95 rounded-2xl border shadow p-4">
          <h3 class="text-lg font-bold text-indigo-700 mb-2">Liste</h3>

          <div *ngIf="filteredPollutions.length === 0" class="text-gray-500 text-sm">
            Aucun résultat.
          </div>

          <div class="space-y-3 max-h-[520px] overflow-auto pr-1">
            <button
              *ngFor="let p of filteredPollutions"
              (click)="onSelectPollution(p)"
              class="w-full text-left p-3 rounded-xl border hover:bg-gray-50 transition"
              type="button"
            >
              <div class="flex items-start justify-between gap-3">
                <div>
                  <div class="font-semibold text-gray-800">{{ p.titre }}</div>
                  <div class="text-xs text-gray-500">{{ p.lieu }}</div>
                </div>
                <span class="text-xs font-semibold text-indigo-700 bg-indigo-50 px-2 py-1 rounded-full">
                  {{ p.type }}
                </span>
              </div>

              <div class="mt-2 text-xs text-gray-600 line-clamp-2">
                {{ p.description }}
              </div>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
